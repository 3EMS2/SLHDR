#!/usr/bin/env bash

cxx=g++

prefix="/usr/local"

show_help() {
    cat <<EOF
Usage: configure [options]
Options: [defaults in brackets after descriptions]

Options:
  --help                   print this message
  --cxx=<compiler>         define used compiler[${cxx}]
  --sse-folder=DIR         path to slhdr library
  --avx2-folder=DIR        path to slhdr library

  --prefix=PREFIX          install in PREFIX [$prefix_default]
  --libdir=LIBDIR          install library in LIBDIR [PREFIX/lib]
  --incdir=DIR             install headers in DIR [PREFIX/include]
  --pkgdir=DIR             install pkg-config files in DIR [LIBDIR/pkgconfig]
EOF
  exit 0
}


# Override values set by user
for opt do
    optval="${opt#*=}"
    case "$opt" in
        --help|-h) show_help
        ;;
        *)
            optname="${opt%%=*}"
            optname="${optname#--}"
            optname=$(echo "$optname" | sed 's/-/_/g')
            eval $optname='$optval'
        ;;
    esac
done

libdir=${libdir:-${prefix}/lib}
incdir=${incdir:-${prefix}/include}
pkgdir=${pkgdir:-${libdir}/pkgconfig}

cat > config.mak <<EOF
  CXX= ${cxx}
  CFLAGS= -Wall -O3
  SSE_CFLAGS= -msse4.2
  AVX2_CFLAGS= -mavx2
  SSE_FOLDER=${sse_folder}
  AVX2_FOLDER=${avx2_folder}

	PKGDIR=${pkgdir}
	INCDIR=${incdir}
	LIBDIR=${libdir}
EOF
