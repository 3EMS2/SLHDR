#!/usr/bin/env bash
cxx=g++
show_help() {
    cat <<EOF
Usage: configure [options]
Options: [defaults in brackets after descriptions]

Options:
  --help                   print this message
  --cxx=<compiler>         define used compiler[${cxx}]
  --sse_folder=DIR         path to slhdr library
  --avx2_folder=DIR        path to slhdr library
EOF
  exit 0
}

# Override values set by user
for opt do
    optval="${opt#*=}"
    case "$opt" in
        --help|-h) show_help
        ;;
        *)
            optname="${opt%%=*}"
            optname="${optname#--}"
            optname=$(echo "$optname" | sed 's/-/_/g')
            eval $optname='$optval'
        ;;
    esac
done

if [ $(${cxx} -dumpversion) -lt 7 ]; then
  echo "Compiler ${cxx} is incompatible. Version must be 7 or newer."
  exit 0
fi

cat > config.mak <<EOF
  CXX= ${cxx}
  CFLAGS= -Wall -O3
  SSE_CFLAGS= -msse4.2
  AVX2_CFLAGS= -mavx2
  SSE_FOLDER=${sse_folder}
  AVX2_FOLDER=${avx2_folder}
EOF
